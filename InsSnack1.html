
<!doctype html>
<html>
    <head>
        <title>SC-IAT</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="jsPsych/jspsych-5.0.3/jspsych.js"></script>
        <script src="jsPsych/jspsych-5.0.3/jspsych7.js"></script>
		<link href="jsPsych/jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
		<script src="jsPsych/jspsych-5.0.3/plugins/jspsych-text.js"></script>
		<script src="jsPsych/jspsych-5.0.3/plugins/jspsych-IATs.js"></script>
		<script src="jsPsych/jspsych-5.0.3/plugins/jspsych-survey-text.js"></script>
		<script src="jsPsych/jspsych-5.0.3/plugins/jspsych-instructions.js"></script>
		<script src="jsPsych/jspsych-5.0.3/plugins/jspsych-call-function.js"></script>
	</head>
    <body>
	<div class = "left-side"> </div>
	<div class = "right-side"> </div>
	</body>
	<script>
	
	/* randomize time between each trial */
	var post_trial_gap = function()
	{
		return Math.floor( Math.random() * 50) + 100;
	}
	
	/* get participant ID and condition*/
	var urlvar = jsPsych.data.urlVariables();
		
	/* ===============INSTRUCTION BLOCKS==================*/
	
	var intro =
	{
		type:"text"
		,data:{trial_name: 'introduction'}
		,text:         '<p class ="instructions">INSTRUCTIONS:<br></br>In this task, you will be presented with several words'+
				' and you will have to sort them into several groups.'
				+'<br></br>This task requires that you sort the words as quickly as possible while making as few mistakes as possible.'
				+'<br></br>In order to be able to respond quickly, keep your LEFT INDEX FINGER on the <b> E </b> key and your RIGHT INDEX FINGER on the <b> P </b> key'
				+'<br></br>The two labels at the top of the screen will tell you which words are associated with each key.'
				+'<br></br>GO AS FAST AS YOU CAN while making as few mistakes as possible. '
				+'Press the E or P key to begin.</p>'
		
		,cont_key: ['e','p']
		,on_trial_start: function()
			{
				$('div.left-side').empty();
				$('div.right-side').empty();
			}
	}
	
	
	/* define instructions block */
    var instructions0 = 
	{
        type: "text"
		,data:{trial_name: 'instructions0'}
        ,text: '<p class ="left-side-begin">Positive</p>'
				+'<p class ="right-side-begin">Negative</p>'
				+ '<p class="instructions"><br></br>Words representing the categories at the top will appear one-by-one in the middle of the screen.'
				+ '<br></br>When the item belongs to a category on the left, press the E key'
				+ '<br></br>When the item belongs to a category on the right, press the P key.'
				+ '<br></br>Items belong to only one category. If you make an error, an X will appear.'
				+'<br></br>Press the space bar to continue.</p>'
		,timing_post_trial: 2000
		,cont_key: ['space']
	};
    var instructions = 
	{
        type: "text"
		,data:{trial_name: 'instructions'}
        ,text: '<p class ="left-side-begin">Positive<br>OR</br>Snacks</p>'
				+'<p class ="right-side-begin">Negative</p>'
				+ '<p class="instructions"><br></br>Note: There are now THREE Catagories.'
				+ '<br></br> Words representing the categories at the top will appear one-by-one in the middle of the screen.'
				+ '<br></br>When the item belongs to a category on the left, press the E key'
				+ '<br></br>When the item belongs to a category on the right, press the P key.'
				+ '<br></br>Items belong to only one category. If you make an error, an X will appear.'
				+'<br></br>Press the space bar to continue.</p>'
		,timing_post_trial: 2000
		,cont_key: ['space']
		,on_trial_start: function()
		{
			$('div.left-side').empty();
			$('div.right-side').empty();
		}
	};
		
	/* define instructions2 block */
	var instructions2 = 
	{
        type: "text"
		,data:{trial_name: 'instructions2'}
        ,text: '<p class="instructions">Sort the same three categories again.'
				+ '<br></br>Words representing the categories at the top will appear one-by-one in the middle of the screen. When the item belongs to a category on the left, press the E key; when the item belongs to a category on the right, press the P key. Items belong to only one category. If you make an error, an X will appear.'
				+ '<br></br>GO AS FAST AS YOU CAN while making as few mistakes as possible.'
				+'<br></br>Press the space bar to continue.</p>'
		,timing_post_trial: 2000
		,cont_key: ['space']
		
	};
	
	/* define rev_instructions block */
	var rev_instructions = 
	{
        type: "text"
		,data:{trial_name: 'rev_instructions'}
        ,text: 	'<p class ="left-side-begin">Positive</p>'
				+'<p class ="right-side-begin">Negative<br>or</br>Snacks</p>'
				+'<p class ="instructions">See above, the three categories now appear together in a new configuration. Remember, each item belongs to only one group.'
				+ '<br></br>Words representing the categories at the top will appear one-by-one in the middle of the screen. When the item belongs to a category on the left, press the E key; when the item belongs to a category on the right, press the P key. Items belong to only one category. If you make an error, an X will appear.'
				+ '<br></br>GO AS FAST AS YOU CAN while making as few mistakes as possible.'
				+'<br></br>Press the space bar to continue.</p>'
		,timing_post_trial: 2000
		,cont_key: ['space']
		,on_trial_start: function()
			{
				$('div.left-side').empty();
				$('div.right-side').empty();
			}
	};
	
	
	/* ============IMAGE AND WORDS FOR BLOCKS===============*/
	
	/* block 1 and 2 images and/or words */
	var images_and_words1 =
	[
		{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Chocolate</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Biscuits</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Cake</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Snacks</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Chips</p>', is_html:true, key_answer: 69}
	];
	var im1 = jsPsych.randomization.sample(images_and_words1,10,true);
	
	var images_and_words2 =
	[	
		{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Good</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Wise</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Beneficial</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Valueable</p>', is_html:true, key_answer: 69}
	];
	var im2 = jsPsych.randomization.sample(images_and_words2,7,true);
	
	var images_and_words3 =
	[
		{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Bad</p>', is_html:true, key_answer: 80}
		,{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Foolish</p>', is_html:true, key_answer: 80}
		,{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Harmful</p>', is_html:true, key_answer: 80}
		,{stimulus: '<p class="IAT-stimuli"; style="color: green; font-size: 35px">Worthless</p>', is_html:true, key_answer: 80}
	];
	var im3 = jsPsych.randomization.sample(images_and_words3,7,true);
		
	/* block 3 and 4 images and/or words change */
	var images_and_words4 =
	[
		{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Chocolate</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Biscuits</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Cake</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Snacks</p>', is_html:true, key_answer: 69}
		,{stimulus: '<p class="IAT-stimuli"; style="font-size: 35px">Chips</p>', is_html:true, key_answer: 69}
	];
	
	var im4 = jsPsych.randomization.sample(images_and_words4,10,true);
	var im5 = jsPsych.randomization.sample(images_and_words2,7,true);
	var im6 = jsPsych.randomization.sample(images_and_words3,7,true);
	
	/* =============RANDOMIZATION OF STIMULI IN BLOCKS================== */
	
	/* practice trial stimuli randomization */
	var block0 = im2.concat(im3)
	var block0_stimuli = jsPsych.randomization.repeat(block0,1)

	
	var block1and2 = im1.concat(im2,im3);
	var practice_trial_stimuli = jsPsych.randomization.repeat(block1and2,1);
	
	/* full trial stimuli randomization */

	var full_trial_stimuli = jsPsych.randomization.repeat(block1and2,3);

	/* reverse practice trial stimuli randomization */
	var block3and4 = im4.concat(im5,im6);
	var rev_practice_trial_stimuli = jsPsych.randomization.repeat(block3and4,1);
	
	/* reverse full trial stimuli randomization */
	var rev_full_trial_stimuli = jsPsych.randomization.repeat(block3and4,3);
	 
	
	/* =================DEFINE BLOCKS================= */
	
	/* define practice trial block */
	var familiarity_trial =
	{
		type: 'IAT'
		,choices: ['E','P']
		,data:{trial_name: 'familiarity'}
		,timing_post_trial: post_trial_gap
		,timing_feedback_duration: 150
		,force_correct_button_press: false
		,timing_response: 1500
		,timeline: block0_stimuli
		,left_target: '<p>Positive</p>'
		,right_target: '<p>Negative</p>'
	
	};
		

	
	var practice_trial =
	{
		type: 'IAT'
		,choices: ['E','P']
		,data:{trial_name: 'practice'}
		,timing_post_trial: post_trial_gap
		,timing_feedback_duration: 150
		,force_correct_button_press: false
		,timing_response: 1500
		,timeline: practice_trial_stimuli
		,left_target: '<p>Positive<br>or</br>Snacks</p>'
		,right_target: '<p>Negative</p>'
	
	};
		
	/* define full trial block */
	var full_trial =
	{
		type: 'IAT'
		,choices: ['E','P']
		,data:{trial_name: 'full_trial'}
		,timing_post_trial: post_trial_gap
		,timing_feedback_duration: 150
		,timing_response: 1500
		,force_correct_button_press: false
		,timeline: full_trial_stimuli
		,left_target: '<p>Positive<br>or</br>Snacks</p>'
		,right_target: '<p>Negative</p>'
	};

	/* define reverse practice trial block */
	var rev_practice_trial =
	{
		type: 'IAT'
		,choices: ['E','P']
		,data:{trial_name: 'reverse_practice'}
		,timing_post_trial: post_trial_gap
		,timing_feedback_duration: 150
		,timing_response: 1500
		,force_correct_button_press: false
		,timeline: rev_practice_trial_stimuli
		,left_target: '<p>Positive</p>'
		,right_target: '<p>Negative<br>or</br>Snacks</p>'
	};
	
	/* define reverse full trial block */
	var rev_full_trial =
	{
		type: 'IAT'
		,choices: ['E','P']
		,data:{trial_name: 'rev_full_trial'}
		,timing_post_trial: post_trial_gap
		,timing_feedback_duration: 150
		,timing_response: 1500
		,force_correct_button_press: false
		,timeline: rev_full_trial_stimuli
		,left_target: '<p>Positive</p>'
		,right_target: '<p>Negative<br>or</br>Snacks</p>'

	};
	
	var debrief =
	{
		type: "text"
		,data:{trial_name: 'debrief'}
        ,text:'<p class = "instructions">Please press the space-bar key to move onto the second word association task </p>'
		,on_trial_start: function()
			{
				$('div.left-side').empty();
				$('div.right-side').empty();
			}
		,cont_key: ['space']
		//,on_finish: function()
		//{
		//	window.close();
		//}
	}
	
	/* ====================CREATE EXPERIMENT TIMELINE AND START IT================= */
	
	jsPsych.data.addProperties({
		subject: urlvar.subject
	});
	
	/* create experiment timeline array */
	var timeline = [];
	timeline.push(intro)
	timeline.push(instructions0);
	timeline.push(familiarity_trial);
	timeline.push(instructions);
	timeline.push(practice_trial);
	timeline.push(instructions2);
	timeline.push(full_trial);
	timeline.push(rev_instructions);
	timeline.push(rev_practice_trial);
	timeline.push(instructions2);
	timeline.push(rev_full_trial);
	
	
	/* write to server */
	function saveData(filename, filedata)
	{
	  $.ajax({
      type:'post',
      cache: false,
      url: 'iatphp.php', // this is the path to the above PHP script
      data: {filename: filename, filedata: filedata}
   });
	}

		
	/* grab data before the end of the experiment */
	var save_data = {
	type: 'call-function'
	,func: function()
		{
			saveData("InstrumentalSnackIAT1_"+urlvar.subject+".csv", jsPsych.data.dataAsCSV())
		}
	,timing_post_trial: 0
	}
	

    
	/* save data and debrief */
	timeline.push(save_data);
	timeline.push(debrief);
	
	/* start the experiment */

	var images = ['jsPsych/jspsych-5.0.3/img/Apple_Logo.jpg'];

	jsPsych.pluginAPI.preloadImages(images, function(){ startExperiment(); });

	function startExperiment(){
	jsPsych.init({
		fullscreen: true
		,timeline: timeline
		,on_finish: function()
		{
			window.location.replace("http://YOURSERVER.com/AffSnack2.html?subject="+urlvar.subject);
		}
	});
	}
    </script>
</html>

